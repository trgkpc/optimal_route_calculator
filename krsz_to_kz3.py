#!/usr/bin/python3.6
from basic import *

mergin = 0.107 + 0.2
zone_mergin = 0.05
ball_mergin = 0.107 + 0.1

init_r =  [ 0.5 ,2.05 ,3.141592653589793] 

# 計算結果(2020年5月10日)
vias_data = [
    [2.574167931575318, [2.6895599763177485, -1.098205738943986, -0.08525732400330498], [4.756971209185193, -1.511105477302457, -0.09158337977267526]],
    [2.0236919851282065, [-0.08482098461113213, 0.9588807478026746, 0.08534546378745834], [-1.9589410102225504, 1.326361824523146, 0.08208808374608748]],
    [1.1868020084624413, [-3.6131811311101303, -0.021965742855009372, -0.11878537521148223], [-2.095865270712069, -0.5531638269102205, -0.1339093833424595]],
    [0.7936676721474202, [-2.16977663591148, -0.038110549531512716, -0.0001861745737863987], [2.1341004363169267, -0.4064388011436729, -7.814077618174946e-05]],
]

# 計算結果(2020年7月18日)
vias_data = [
    [2.554093332246685, [2.748891305594371, -1.0916886311268865, -0.10831695503117546], [4.862966167464165, -1.5005398262255238, -0.12229255611749523]],
    [1.9846149476849588, [0.07420633440046395, 1.0474919755877734, 0.07862120562502985], [-2.078554520214408, 1.4644764524406468, 0.07220589919593269]],
    [0.8431075078429301, [-3.642953387913779, -0.32250175219244764, -0.2290360001260069], [-2.384000671363682, -0.686619892871983, -0.2110128426442513]],
    [1.1999999999999862, [-2.2190396163240083, -0.3824389948978625, -3.111010273600973e-05], [1.8370740873186933, -0.8635977154538372, -2.765146721072837e-05]],
]

# 計算結果(2020年7月22日) 最後の経路を直線にした
vias_data = [
    [2.5663430227623825, [2.7805736298432424, -1.1180010278266395, -0.10273215763938712], [4.919210930116046, -1.536459155543523, -0.11430334525661108]],
    [1.9578681832777851, [-0.023283601486773116, 1.163336324845221, 0.09803947911330867], [-2.348238746594717, 1.6084880586800012, 0.08918902949947534]],
    [0.8591333122528396, [-3.7051019114739536, -0.07684905007121265, -0.14037928210773962], [-2.487733170101678, -0.6595651247976403, -0.17046306060911162]],
    [1.1999999999999, [-1.4826913082164301, 0.29156250631521263, 6.0216598284559163e-05], [1.7623138431941774, -0.3465177955349603, 2.7422127212838045e-05]],
]


x0 = expand(vias_data)

gen_poll_route = lambda num:gen_poll_route_strict(init_r, num, p5, machine_size, mergin, N=20)

cons = (
    # ポールに当たらない制約
    gen_poll_route(0),
    gen_poll_strict(init_r, 0, p5, machine_size, mergin),
    gen_poll_route(1),
    gen_poll_strict(init_r, 1, p5, machine_size, mergin),
    gen_poll_route(2),
    # 途中の点を「ここらへんに置く」という制約
    gen_center_in_area(init_r, 0, [[2.9, 10.0], [0.0, 2.575], [-1000,3000]]),
    gen_center_in_area(init_r, 1, [[2.6, 10.0], [2.575, 100], [-1000,3000]]),
    gen_center_in_area(init_r, 2, [[0.0, 4.0], [2.575, 100], [-1000,3000]]),
    # 最後に回転しない制約
    gen_last_route_not_rotate_strict(),
    gen_last_route_const_acc_strict(),
    # 経路終点の制約
    gen_in_kz3(init_r, -1, machine_size, zone_mergin),
    gen_kickable(init_r, -1, goll_post),
    gen_kick_ball_reachable(init_r, goll_post, p3, ball_mergin),
    gen_stop_check(init_r,-1),
    # 時間を遡らない制約
    gen_forward_check(0),
    gen_forward_check(1),
    gen_forward_check(2),
    gen_forward_check(3, 1.2),
)

# optimize(init_r, mergin, x0, cons, maxiter=100, visualize=True):
optimize(init_r, mergin, x0, cons, "krsz_to_kz3", maxiter=2000)




